<h1>Historique</h1>
<div class="history-top">
    <div class="btn-group" data-toggle="buttons-radio">
	    <a href="<%= history_index_path %>?time=0" class="btn btn-small<%= ' active' if @time == 0 %>">Toujours</a>
	    <a href="<%= history_index_path %>?time=8766" class="btn btn-small<%= ' active' if @time == 8766 %>">1 an</a>
	    <a href="<%= history_index_path %>?time=4392" class="btn btn-small<%= ' active' if @time == 4392 %>">6 mois</a>
	    <a href="<%= history_index_path %>?time=720" class="btn btn-small<%= ' active' if @time == 720 %>">1 mois</a>
	    <a href="<%= history_index_path %>?time=168" class="btn btn-small<%= ' active' if @time == 168 %>">1 semaine</a>
	    <a href="<%= history_index_path %>?time=24" class="btn btn-small<%= ' active' if @time == 24 %>">24 heures</a>
    </div>
</div>
<div class="row-fluid">
	<div class="span12">
		<div class="widget">
			<div class="widget-header"><i class="icon-bookmark"></i><h3>Évolution globale</h3></div>
			<div class="widget-content">
				<div id="HistoryGlobal" class="flot flot-width-full height-200">
					<div class="spinner"><i class="icon-spinner icon-spin"></i></div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="row-fluid">
	<% index = 1 %>
	<% @rooms.each do |room| %>
		<div class="span6">
			<div class="widget">
				<div class="widget-header"><i class="icon-bookmark"></i><h3><%= room.name %></h3></div>
				<div class="widget-content">
					<div id="History<%= room.id %>" class="flot flot-width-full height-200">
						<div class="spinner"><i class="icon-spinner icon-spin"></i></div>
					</div>
				</div>
			</div>
		</div>
		<% if (index % 2) == 0 %>
			</div>
			<div class="row-fluid">
		<% end %>
		<% index = index + 1 %>
	<% end %>
</div>

<script src="/assets/jquery.js?body=1" type="text/javascript"></script>
<script src="/assets/jquery_ujs.js?body=1" type="text/javascript"></script>
<script type="text/javascript">
function graphes(){
    // Graphe des mesures récentes
	var t = (new Date()).getTime();
	var options = {
        grid : {
                color: "#AAA",
                backgroundColor: { colors: ["#444", "#333"] },
                hoverable: true,
                borderWidth: 1
            },
		legend: {
				position: "sw",
                backgroundColor: "#aaaaaa",
                backgroundOpacity: 0.3
			},
		xaxis: {
				mode: "time",
				timeformat: "%H:%M",
				timezone: "browser",
                color: "#666"
			},
        yaxis: {
                color: "#888"
        }
	};
	var options2 = {
        grid : {
                color: "#AAA",
                backgroundColor: { colors: ["#444", "#333"] },
                hoverable: true,
                borderWidth: 1
            },
		legend: {
				show:false
			},
		xaxis: {
				mode: "time",
				timeformat: "%H:%M",
				timezone: "browser",
                color: "#666"
			},
        yaxis: {
                color: "#888"
        }
	};

	$.ajax({
		url: "/getRecentJSON?time=<%= @time %>",
		method: 'GET',
		dataType: 'json',
		success: function(json){
			data = json;
			$("#HistoryGlobal").plot(data, options);
		}
	});
	<% @rooms.each do |room| %>
		$.ajax({
			url: "/getRecentJSON?room=<%= room.id %>&time=<%= @time %>",
			method: 'GET',
			dataType: 'json',
			success: function(json){
				data = json;
				$("#History<%= room.id %>").plot(data, options2);
			}
		});
	<% end %>
}
</script>